<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="map[name:Austin Barnes]"><meta name=description content="Terraform Automation in Azure with Kubernetes"><meta name=keywords content=",terraform,kubernetes,automation,azure,aks"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://www.cinderblook.com/projects/terraform-azure-k8s-deploy/><title>Terraform - Azure-K8S-Deploy :: Austin Barnes â€” Personal Site</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://www.cinderblook.com/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css><link rel=apple-touch-icon sizes=180x180 href=https://www.cinderblook.com/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.cinderblook.com/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.cinderblook.com/favicon-16x16.png><link rel=manifest href=https://www.cinderblook.com/site.webmanifest><link rel=mask-icon href=https://www.cinderblook.com/safari-pinned-tab.svg color><link rel="shortcut icon" href=https://www.cinderblook.com/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Terraform - Azure-K8S-Deploy"><meta itemprop=description content="Terraform Automation in Azure with Kubernetes"><meta itemprop=datePublished content="2022-04-04T00:00:00+00:00"><meta itemprop=dateModified content="2022-04-04T00:00:00+00:00"><meta itemprop=wordCount content="726"><meta itemprop=image content="https://www.cinderblook.com/"><meta itemprop=keywords content="terraform,kubernetes,automation,azure,aks,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.cinderblook.com/"><meta name=twitter:title content="Terraform - Azure-K8S-Deploy"><meta name=twitter:description content="Terraform Automation in Azure with Kubernetes"><meta property="og:title" content="Terraform - Azure-K8S-Deploy"><meta property="og:description" content="Terraform Automation in Azure with Kubernetes"><meta property="og:type" content="article"><meta property="og:url" content="https://www.cinderblook.com/projects/terraform-azure-k8s-deploy/"><meta property="og:image" content="https://www.cinderblook.com/"><meta property="article:section" content="projects"><meta property="article:published_time" content="2022-04-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-04T00:00:00+00:00"><meta property="og:see_also" content="https://www.cinderblook.com/posts/2022/04/terraform-converting-azure-resources/"><meta property="og:see_also" content="https://www.cinderblook.com/projects/terraform-proxmox-vm-deploy/"><meta property="og:see_also" content="https://www.cinderblook.com/projects/terraform-azure-serv-deploy/"><meta property="og:see_also" content="https://www.cinderblook.com/projects/terraform-vsphere-winserv-deployment/"><meta property="article:section" content="Projects"><meta property="article:section" content="Terraform"><meta property="article:section" content="Kubernetes"><meta property="article:section" content="Azure"><meta property="article:section" content="Linux"><meta property="article:section" content="aks"><meta property="article:published_time" content="2022-04-04 00:00:00 +0000 UTC"></head><body><div class=container><header class=header><span class=header__inner><a href=https://www.cinderblook.com/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>$ cd /home/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://www.cinderblook.com/about>About</a></li><li><a href=https://www.cinderblook.com/posts>Posts</a></li><li><a href=https://www.cinderblook.com/projects>Projects</a></li><li><a href=https://www.cinderblook.com/sites>Sites</a></li><li><a href=https://www.cinderblook.com/tags>Tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><h2 class=post-title><a href=https://www.cinderblook.com/projects/terraform-azure-k8s-deploy/>Terraform - Azure-K8S-Deploy</a></h2><div class=post-content><h1 id=overview>Overview</h1><p>Deplying a Kubernetes Cluster in Azure with the AKS service.</p><ul><li>Build a Kubernetes cluster in Azure</li><li>Have the cluster setup to automatically scale with load</li><li>Have Kubeconfig file available so it can be managed, changed, altered, destroyed, etc.</li><li>Ensure Kubeconfig file is secure, and is being encrypted with traffic involved in this</li></ul><p><strong>Check out all of the configuration files on <a href=https://github.com/Cinderblook/tacklebox/tree/main/Terraform/Azure/Azure-K8S-Deploy>GitHub</a> at the repository!</strong></p><h1 id=steps-to-do-this>Steps to do this</h1><ol><li>Have an Azure account; <em>if you are a student, sign up for a student account and get some free credits along side it.</em></li><li>Setup Terraform files for the deployment</li><li>Keep track of Terraform State and Kubeconfig files in order to continue managaing deployed resources</li></ol><h1 id=terraform-process>Terraform Process</h1><h2 id=setting-up-providers-azurerm--kubernetes>Setting up Providers; Azurerm & Kubernetes</h2><p>Create a file named provider.tf I personally use the Azure CLI, this guide will be based on that. Use <code>az login</code> to connect to your Azure resources. Refer to <a href=https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli>Microsoft&rsquo;s documentation for Azure CLI</a>. For Terraform, we are using the <a href=https://registry.terraform.io/browse/providers>Azurerm, and Kubernetes Poviders</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#a6e22e>terraform</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>required_providers</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>azurerm</span> = {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>source</span>  = <span style=color:#e6db74>&#34;hashicorp/azurerm&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>version</span> = <span style=color:#e6db74>&#34;3.0.2&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>provider</span> <span style=color:#e6db74>&#34;azurerm&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>features</span> {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>provider</span> <span style=color:#e6db74>&#34;kubernetes&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>host</span>        = data.<span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>credneitals</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>host</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>client_certificate</span>     = base64decode(data.<span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>credneitals</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>client_certificate</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>client_key</span>             = base64decode(data.<span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>credneitals</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>client_key</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>cluster_ca_certificate</span> = base64decode(data.<span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>credneitals</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>cluster_ca_certificate</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=setting-up-the-kubernetes-structure>Setting up the Kubernetes structure</h2><p>Create a file nameed cluster.tf. Within this file, we will define required networking and cluster resources/data parameters.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#75715e># Resource Group for Terraform deployment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_resource_group&#34;</span> <span style=color:#e6db74>&#34;cluster&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>     = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-cluster&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>location</span> = var.<span style=color:#a6e22e>region</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Networking Setup for Cluster
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_virtual_network&#34;</span> <span style=color:#e6db74>&#34;cluster&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-network&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>location</span>            = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>location</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resource_group_name</span> = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>address_space</span>       = [<span style=color:#e6db74>&#34;10.1.0.0/16&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_subnet&#34;</span> <span style=color:#e6db74>&#34;cluster&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                 = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-subnet&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>virtual_network_name</span> = <span style=color:#a6e22e>azurerm_virtual_network</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resource_group_name</span>  = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>address_prefixes</span>     = [<span style=color:#e6db74>&#34;10.1.0.0/24&#34;</span>]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;azurerm_kubernetes_cluster&#34;</span> <span style=color:#e6db74>&#34;cluster&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-aks&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>location</span>            = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>location</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resource_group_name</span> = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dns_prefix</span>          = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-aks&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>linux_profile</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>admin_username</span> = <span style=color:#e6db74>&#34;ubuntu&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ssh_key</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>key_data</span> = file(var.<span style=color:#a6e22e>ssh_public_key</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default_node_pool</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span>                = <span style=color:#e6db74>&#34;agentpool&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>node_count</span>          = var.<span style=color:#a6e22e>cluster_nodes_count</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>vm_size</span>             = <span style=color:#e6db74>&#34;Standard_B2s&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>type</span>                = <span style=color:#e6db74>&#34;VirtualMachineScaleSets&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    #availability_zones  = [&#34;1&#34;, &#34;2&#34;]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>enable_auto_scaling</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>min_count</span>           = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>max_count</span>           = <span style=color:#ae81ff>3</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>    # Required for advanced networking
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>vnet_subnet_id</span> = <span style=color:#a6e22e>azurerm_subnet</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>identity</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>type</span> = <span style=color:#e6db74>&#34;SystemAssigned&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network_profile</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>network_plugin</span>    = <span style=color:#e6db74>&#34;kubenet&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>load_balancer_sku</span> = <span style=color:#e6db74>&#34;standard&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Environment</span> = <span style=color:#e6db74>&#34;Development&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Required to be pushed into Kubernetes Provid`er in provider.tf
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>data</span> <span style=color:#e6db74>&#34;azurerm_kubernetes_cluster&#34;</span> <span style=color:#e6db74>&#34;credneitals&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>resource_group_name</span> = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span>          = [<span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>]
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># This will bring down the required kubeconfig locally to your machine
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;local_file&#34;</span> <span style=color:#e6db74>&#34;kubeconfig&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>depends_on</span>   = [<span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>filename</span>     = <span style=color:#e6db74>&#34;./kubeconfig&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>content</span>      = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config_raw</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=assigning-variables-for-terraform>Assigning variables for Terraform</h2><p>Create a file named variables.tf. Generally, these variables within the file are ready to go. Ensure the public key is pointing to your SSH key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;cluster_name&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span> = <span style=color:#e6db74>&#34;terraformclust&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;cluster_nodes_count&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span> = <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;region&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span> = <span style=color:#e6db74>&#34;East US 2&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;prefix&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span> = <span style=color:#e6db74>&#34;az-ter&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;ssh_public_key&#34;</span>{
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span> = <span style=color:#e6db74>&#34;./id_rsa.pub&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=creating-outputs-to-be-sent-back-after-terraform-finishes-running>Creating outputs to be sent back after Terraform finishes running</h2><p>Create a file named output.tf. Certain parts of the output file are critical to get access to the cluster once it is spun up. Specifically the cluster_name, and resource_group_name outputs are essential.These will be used in order to obtain kubectl access for managing the cluster. I included a few extra output resources for future usage.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;client_key&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>client_key</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;client_certificate&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>client_certificate</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;cluster_ca_certificate&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>cluster_ca_certificate</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;cluster_username&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>username</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;cluster_password&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>password</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;kube_config&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config_raw</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;host&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>kube_config</span>.<span style=color:#ae81ff>0</span>.<span style=color:#a6e22e>host</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sensitive</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}<span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e># Critical to get kubectl file connected out to Azure for local environment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;cluster_name&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_kubernetes_cluster</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>output</span> <span style=color:#e6db74>&#34;resource_group_name&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>azurerm_resource_group</span>.<span style=color:#a6e22e>cluster</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=gain-access-to-kubectl>Gain access to Kubectl</h2><p>In order to gain access from your local machine, we will use the azure CLI. If you followed the tutorial, you&rsquo;ll already be logged in, <code>az login</code>. Use the following command to set your environment varialbe for kubectl to control kubernetes cluster in Azure.
<code>az aks get-credentials --resource-group $(terraform output -raw resource_group_name) --name $(terraform output -raw cluster_name)</code></p><p>Once ran, you can verify it is connected and working with <code>kubectl get nodes</code> , <code>kubectl get namespace</code></p><h1 id=useful-resources>Useful Resources</h1><ul><li><a href=https://learnk8s.io/terraform-aks>Kubernetes Overview</a></li><li><a href=https://registry.terraform.io/providers/hashicorp/kubernetes/latest>Terraform Kubernetes</a></li><li><a href=https://registry.terraform.io/providers/hashicorp/azurerm/latest>Terraform Azurerm</a></li></ul></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://www.cinderblook.com/tags/terraform/>terraform</a></span>
<span class=tag><a href=https://www.cinderblook.com/tags/kubernetes/>kubernetes</a></span>
<span class=tag><a href=https://www.cinderblook.com/tags/automation/>automation</a></span>
<span class=tag><a href=https://www.cinderblook.com/tags/azure/>azure</a></span>
<span class=tag><a href=https://www.cinderblook.com/tags/aks/>aks</a></span></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg><span class=tag><a href=https://www.cinderblook.com/categories/projects/>Projects</a></span>
<span class=tag><a href=https://www.cinderblook.com/categories/terraform/>Terraform</a></span>
<span class=tag><a href=https://www.cinderblook.com/categories/kubernetes/>Kubernetes</a></span>
<span class=tag><a href=https://www.cinderblook.com/categories/azure/>Azure</a></span>
<span class=tag><a href=https://www.cinderblook.com/categories/linux/>Linux</a></span>
<span class=tag><a href=https://www.cinderblook.com/categories/aks/>aks</a></span></p></div></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2022</span>
<span><a href=https://www.cinderblook.com/>Austin Barnes</a></span>
<span><a href=https://www.cinderblook.com/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div></footer></div><script type=text/javascript src=https://www.cinderblook.com/bundle.min.a2c5b062c87998f04d1b5dfb6a89a1b2d79786c21d0cb63a05e8a2082984b64b77d80955e3b97eab17273775162ba372511b711fea2f7608f216e68a67bb22d6.js integrity="sha512-osWwYsh5mPBNG137aomhsteXhsIdDLY6BeiiCCmEtkt32AlV47l+qxcnN3UWK6NyURtxH+ovdgjyFuaKZ7si1g=="></script></body></html>